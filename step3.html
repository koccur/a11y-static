<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>A11y - Claim report</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <!--  <link rel="preconnect" href="https://fonts.gstatic.com">-->
  <!--  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">-->
  <!--  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">-->
  <link rel="stylesheet" href="assets/style.css">
  <script src="https://cdn.jsdelivr.net/ally.js/1.4.1/ally.min.js"></script>
  <script src="js/base.js"></script>
  <script src="js/step3.js"></script>
  <script src="js/trap_focus.js"></script>
</head>
<body>
<header class="flex flex-spacebetween flex-align-center" id="header">
  <button class="menu no-hover-color" aria-haspopup="true" onclick="toggleMenu()">
    <img src="assets/square.png" alt="Open menu"/>
    <button aria-label="close popup" type="button" class="hidden ext-button" onclick="toggleMenu()">
      <svg class="icon" x="0px" y="0px" viewBox="0 0 512.001 512.001" style="enable-background:new 0 0 512.001 512.001;"
           xml:space="preserve"
           aria-label="close popup icon"><g><g><path d="M284.286,256.002L506.143,34.144c7.811-7.811,7.811-20.475,0-28.285c-7.811-7.81-20.475-7.811-28.285,0L256,227.717
			L34.143,5.859c-7.811-7.811-20.475-7.811-28.285,0c-7.81,7.811-7.811,20.475,0,28.285l221.857,221.857L5.858,477.859
			c-7.811,7.811-7.811,20.475,0,28.285c3.905,3.905,9.024,5.857,14.143,5.857c5.119,0,10.237-1.952,14.143-5.857L256,284.287
			l221.857,221.857c3.905,3.905,9.024,5.857,14.143,5.857s10.237-1.952,14.143-5.857c7.811-7.811,7.811-20.475,0-28.285
			L284.286,256.002z"/></g></g></svg>
    </button>

  </button>
  <div class="menu no-hover-color">
    <ul class="menu-list hidden" id="menu-list">
      <li class="no-list-style" onclick="toggleMenu()">
        <a href="./index.html">Insurance</a>
      </li>
      <li class="no-list-style" onclick="toggleMenu()">
        <a href="./aboutus.html">About us</a>
      </li>
      <li class="no-list-style">
        <a href="./claim-report.html" class="active">Claim report</a>
      </li>
      <li class="no-list-style" onclick="toggleMenu()">
        <a href="./contact.html">Contact</a>
      </li>
    </ul>
  </div>
  <section aria-label="insurer header" class="flex flex-justify-start flex-align-center">
    <p class="h2-size">The insurer</p>
    <img class="avatar" src="assets/Circle_Grey_Solid.png" alt="Insurer avatar"/>
  </section>
  <nav>
    <ul class="no-list-style flex fxLayoutGap-1">
      <li class="min-width-link"><a href="./index.html" id="firstLink">Insurance</a></li>
      <li class="min-width-link"><a href="./aboutus.html">About us</a></li>
      <li class="min-width-link"><a href="./claim-report.html" class="active">Claim report</a></li>
      <li class="min-width-link"><a href="./contact.html">Contact</a></li>
    </ul>
  </nav>

</header>
<main class="flex flex-column">
  <section class="flex border-top flex-column flex-align-center flex-justify-center fxLayoutGap-1">
    <h1 class="biggerFont">Claim report</h1>
    <div class="m-t-l flex fxLayoutGap-15 flex-column-xs">
      <button aria-label="step 1 - personal details" class="gray-button " onclick="goToStep1(null)" onkeydown="goToStep1(event)">Step 1 -
        Personal details
      </button>
      <button aria-label="step 2 - Incident details" class="gray-button" onclick="goToStep2(null)" onkeydown="goToStep2(event)">Step 2 -
        Incident details
      </button>
      <button aria-label="Step 3 - Expense report" id="button3" class="gray-button blue-outline active" onclick="goToStep3(null)"
              onkeydown="goToStep3(event)">Step 3 - Expense report
      </button>
    </div>
    <form>
      <div class="table-container" id="step3">
        <table>
          <caption><b>Expense report</b></caption>
          <thead>
          <tr>
            <th scope="col"><b>Price</b></th>
            <th scope="col"><b>Description</b></th>
            <th scope="col"><b>Delete action</b></th>
            <th scope="col"><b>Edit action</b></th>
          </tr>
          </thead>
        </table>
        <button aria-haspopup="true" id="addButton" class="stick-to-right-button" type="button"
                aria-label="add another expense, button open popup"
                onclick="openModal('dialog','addButton')"> + Add another expense
        </button>
      </div>
    </form>
    <div class="m-t-l flex flex-justify-center flex-spacebetween fxLayoutGap-15 flex-column-xs">
      <button class="white-button" type="button" aria-label="Return to Incident details" id="backButton" onclick="goToStep2()"
              onkeydown="goToStep2(event)">Return to Incident details
      </button>
      <div id="block-separator"></div>
      <button id="submit" class="black-button blue-outline" type="button" aria-label="Submit data" onkeydown="onSubmit(event)"
              onclick="onSubmit()">Submit
      </button>
    </div>
  </section>

  <div class="modal" id="dialog" role="dialog">
    <section class="modal-content">
      <div class="flex flex-justify-end">
        <button aria-label="close popup" id="closeButton-dialog" type="button" class="transparent" onclick="closeOnEnter('dialog',null)"
                onkeydown="closeOnEnter('dialog',event)">
          <svg class="icon" x="0px" y="0px" viewBox="0 0 512.001 512.001" style="enable-background:new 0 0 512.001 512.001;"
               xml:space="preserve"
               aria-label="close popup icon"><g><g><path d="M284.286,256.002L506.143,34.144c7.811-7.811,7.811-20.475,0-28.285c-7.811-7.81-20.475-7.811-28.285,0L256,227.717
			L34.143,5.859c-7.811-7.811-20.475-7.811-28.285,0c-7.81,7.811-7.811,20.475,0,28.285l221.857,221.857L5.858,477.859
			c-7.811,7.811-7.811,20.475,0,28.285c3.905,3.905,9.024,5.857,14.143,5.857c5.119,0,10.237-1.952,14.143-5.857L256,284.287
			l221.857,221.857c3.905,3.905,9.024,5.857,14.143,5.857s10.237-1.952,14.143-5.857c7.811-7.811,7.811-20.475,0-28.285
			L284.286,256.002z"/></g></g></svg>
        </button>
      </div>
      <h1 style="text-align: center">Expense</h1>
      <form class="flex flex-column fxLayoutGap-025">
        <div class="flex flex-column fxLayoutGap-025 name-field input-container">
          <label for="name">Name
            <img class="icon" src="assets/error.png" alt=""/>
          </label>
          <input type="text" name="name" id="name" aria-describedBy="err_name">
          <span class="error" id="err_name">Please enter expenses name</span>
        </div>
        <div class="flex flex-column fxLayoutGap-025 price-field input-container">
          <label for="price">Price
            <img class="icon" src="assets/error.png" alt=""/>
          </label>
          <input type="text" name="price" id="price" aria-describedBy="err_price">
          <span class="error" id="err_price">Please enter expenses price</span>
        </div>
        <div class="flex flex-column-xs flex-justify-center flex-align-center fxLayoutGap-025 m-t-l">
          <button class="white-button" type="button" aria-label="Cancel action" onclick="closeOnEnter('dialog',null)"
                  onkeydown="closeOnEnter('dialog',event)">Cancel
          </button>
          <div style="width:2rem"></div>
          <button class="black-button blue-outline" type="button" aria-label="Confirm expense action"
                  onclick="addElement()">Confirm
          </button>
        </div>
      </form>
    </section>
  </div>

  <div class="modal" id="dialog-edit" role="dialog">
    <section class="modal-content">
      <div class="flex flex-justify-end">
        <button aria-label="close popup" id="closeButton-dialog-edit" type="button" class="transparent"
                onclick="closeOnEnter('dialog-edit',null)"
                onkeydown="closeOnEnter('dialog-edit',event)">
          <svg class="icon" x="0px" y="0px" viewBox="0 0 512.001 512.001" style="enable-background:new 0 0 512.001 512.001;"
               xml:space="preserve"
               aria-label="close popup icon"><g><g><path d="M284.286,256.002L506.143,34.144c7.811-7.811,7.811-20.475,0-28.285c-7.811-7.81-20.475-7.811-28.285,0L256,227.717
			L34.143,5.859c-7.811-7.811-20.475-7.811-28.285,0c-7.81,7.811-7.811,20.475,0,28.285l221.857,221.857L5.858,477.859
			c-7.811,7.811-7.811,20.475,0,28.285c3.905,3.905,9.024,5.857,14.143,5.857c5.119,0,10.237-1.952,14.143-5.857L256,284.287
			l221.857,221.857c3.905,3.905,9.024,5.857,14.143,5.857s10.237-1.952,14.143-5.857c7.811-7.811,7.811-20.475,0-28.285
			L284.286,256.002z"/></g></g></svg>
        </button>
      </div>
      <h1 style="text-align: center">Expense dialog edit</h1>
      <form class="flex flex-column fxLayoutGap-025">
        <div class="flex flex-column fxLayoutGap-025 input-container name-edit-field">
          <label for="name">Name (required)
            <img class="icon" src="assets/error.png" alt=""/>
          </label>
          <input type="text" name="name" id="name-edit" required aria-describedBy="err_name-edit">
          <span class="error" id="err_name-edit">Please enter expenses name</span>
        </div>
        <div class="flex flex-column fxLayoutGap-025 input-container price-edit-field">
          <label for="price">Price (required)
            <img class="icon" src="assets/error.png" alt=""/>
          </label>
          <input type="text" name="price" id="price-edit" required aria-describedBy="err_price-edit">
          <span class="error" id="err_price-edit">Please enter expenses price</span>
        </div>
        <div class="flex flex-column-xs flex-justify-center flex-align-center fxLayoutGap-025 m-t-l">
          <button class="white-button" type="button" aria-label="Cancel action" onclick="closeOnEnter('dialog-edit',null)"
                  onkeydown="closeOnEnter('dialog-edit',event)">Cancel
          </button>
          <div style="width:2rem"></div>
          <button class="black-button blue-outline" type="button" aria-label="Confirm expense action"
                  onclick="closeOnEnter('dialog-edit',null,true)"
                  onkeydown="closeOnEnter('dialog-edit',event,true)">Confirm
          </button>
        </div>
      </form>
    </section>
  </div>

  <div class="modal" id="dialog-remove" role="dialog">
    <section class="modal-content">
      <div class="flex flex-justify-end">
        <button aria-label="close popup" type="button" id="closeButton-dialog-remove" class="transparent"
                onclick="closeOnEnter('dialog-remove',null)" onkeydown="closeOnEnter('dialog-remove',event)">
          <svg class="icon" x="0px" y="0px" viewBox="0 0 512.001 512.001" style="enable-background:new 0 0 512.001 512.001;"
               xml:space="preserve"
               aria-label="close popup icon"><g><g><path d="M284.286,256.002L506.143,34.144c7.811-7.811,7.811-20.475,0-28.285c-7.811-7.81-20.475-7.811-28.285,0L256,227.717
			L34.143,5.859c-7.811-7.811-20.475-7.811-28.285,0c-7.81,7.811-7.811,20.475,0,28.285l221.857,221.857L5.858,477.859
			c-7.811,7.811-7.811,20.475,0,28.285c3.905,3.905,9.024,5.857,14.143,5.857c5.119,0,10.237-1.952,14.143-5.857L256,284.287
			l221.857,221.857c3.905,3.905,9.024,5.857,14.143,5.857s10.237-1.952,14.143-5.857c7.811-7.811,7.811-20.475,0-28.285
			L284.286,256.002z"/></g></g></svg>
        </button>
      </div>
      <h1 class="center">Expense</h1>
      <p>Are you sure that you want to delete this element?</p>
      <p id="chosen_element_data">{{data.name}}: {{data.price}}</p>

      <div class="m-t-l flex flex-column-xs fxLayoutGap-025 flex-justify-center flex-align-center">
        <button class="white-button" type="button" aria-label="Cancel action" onclick="closeOnEnter('dialog-remove',null)"
                onkeydown="closeOnEnter('dialog-remove',event)">
          Cancel
        </button>
        <div style="width:2rem"></div>
        <button class="black-button blue-outline" type="button" aria-label="Remove element"
                id="submit-remove"
                onclick="removeElement();closeOnEnter('dialog-remove',null)"
                onkeydown="removeElement();closeOnEnter('dialog-remove',event)">Remove
        </button>
      </div>
    </section>
  </div>

  <div class="modal" id="dialog-submit" role="dialog">
    <section class="modal-content">
      <div class="flex flex-justify-end">
        <button aria-label="close popup" type="button" id="closeButton-dialog-submit" class="transparent"
                onclick="closeOnEnter('dialog-submit',null)" onkeydown="closeOnEnter('dialog-submit',event)">
          <svg class="icon" x="0px" y="0px" viewBox="0 0 512.001 512.001" style="enable-background:new 0 0 512.001 512.001;"
               xml:space="preserve"
               aria-label="close popup icon"><g><g><path d="M284.286,256.002L506.143,34.144c7.811-7.811,7.811-20.475,0-28.285c-7.811-7.81-20.475-7.811-28.285,0L256,227.717
			L34.143,5.859c-7.811-7.811-20.475-7.811-28.285,0c-7.81,7.811-7.811,20.475,0,28.285l221.857,221.857L5.858,477.859
			c-7.811,7.811-7.811,20.475,0,28.285c3.905,3.905,9.024,5.857,14.143,5.857c5.119,0,10.237-1.952,14.143-5.857L256,284.287
			l221.857,221.857c3.905,3.905,9.024,5.857,14.143,5.857s10.237-1.952,14.143-5.857c7.811-7.811,7.811-20.475,0-28.285
			L284.286,256.002z"/></g></g></svg>
        </button>
      </div>
      <h1 class="black center">Data was send</h1>
      <div class="flex flex-column-xs fxLayoutGap-025 flex-justify-center flex-align-center m-t-l">
        <button class="black-button blue-outline" type="button" aria-label="close popup" onclick="closeOnEnter('dialog-submit',null)"
                onkeydown="closeOnEnter('dialog-submit',event,true)">Close
        </button>
      </div>
    </section>
  </div>

</main>
<footer class="flex flex-column flex-md-row flex-spacebetween gray-background ">
  <section class="avatar-section flex flex-align-center flex-justify-start" aria-label="insurer footer">
    <p class="h2-size">The insurer</p>
    <img class="avatar" src="assets/Circle_Grey_Solid.png" alt="picture of something very important / Insurer avatar"/>
  </section>

  <nav aria-label="links" class="flex">
    <div class="flex flex-column">
      <p class="m-b-0"><b>About us</b></p>
      <ul aria-label="aboutUs" class="no-list-style">
        <li class="p-sm p-l-0 touch-space"><a href="./newsroom.html">Newsroom</a></li>
        <li class="p-sm p-l-0 touch-space"><a href="./careers.html">Careers</a></li>
        <li class="p-sm p-l-0 touch-space"><a href="./our.html">Our story</a></li>
        <li class="p-sm p-l-0 touch-space"><a href="./customer.html">Customer Stories</a></li>
      </ul>
    </div>
    <div class="flex flex-column">
      <p class="m-b-0"><b>Products</b></p>
      <ul aria-label="products" class="no-list-style">
        <li class="p-sm p-l-0 touch-space"><a href="./vacation.html">Vacation / Holiday</a></li>
        <li class="p-sm p-l-0 touch-space"><a href="./student.html">Student / Scholar</a></li>
        <li class="p-sm p-l-0 touch-space"><a href="./mission.html">Mission</a></li>
        <li class="p-sm p-l-0 touch-space"><a href="./marine.html">Marine Captain / Crew</a></li>
        <li class="p-sm p-l-0 touch-space"><a href="./employer.html">Employer / Bussiness Traveler</a></li>
      </ul>
    </div>
    <div class="flex flex-column">
      <p class="m-b-0"><b>Members</b></p>
      <ul aria-label="members" class="no-list-style">
        <li class="p-sm p-l-0 touch-space"><a href="./forms.html">Forms Library</a></li>
        <li class="p-sm p-l-0 touch-space"><a href="./find.html">Find a Doctor</a></li>
        <li class="p-sm p-l-0 touch-space"><a href="./renew.html">Renew Policy</a></li>
        <li class="p-sm p-l-0 touch-space"><a href="./claims.html">Claims Center</a></li>
        <li class="p-sm p-l-0 touch-space"><a href="./sitemap.xml">Sitemap</a></li>
      </ul>
    </div>
  </nav>
  <button type="button" class="floating-button" onclick="function scrollToTop() {
    window.scroll(0,0);
    document.getElementById('firstLink')?.focus();
  }
  scrollToTop()">Back to top
  </button>
</footer>
<script>
  let openMenuSwitch = false;
  let chosenElem = {name: '', price: '', id: 0};
  let lastFocusElem;
  loadItems();
  const customEvent = new Event('close');
  addListenerOnEscButton();
  const dialogSubmit = document.getElementById('dialog-submit');
  const dialogEdit = document.getElementById('dialog-edit');
  const dialogAdd = document.getElementById('dialog');
  const dialogRemove = document.getElementById('dialog-remove');

  dialogSubmit.style.display = "none";
  dialogEdit.style.display = "none";
  dialogAdd.style.display = "none";
  dialogRemove.style.display = "none";

  dialogAdd.addEventListener('close', () => {
    document.getElementById('name').value = '';
    document.getElementById('price').value = '';
  })

  createRows();
  setFocusOnFirstElementOnStep();

  function onClose() {
    setTimeout(() => {
      goToStep1();
    }, 500)
  }

  function closeOnEnter(dialogName, event, validateFields = false) {
    if (validateFields && !validateEditFields()) {
      return;
    }

    if (event && event.keyCode === 13) {
      document.getElementById('closeButton' + '-' + dialogName).click();
    } else if (!event) {
      document.getElementById(dialogName).style.display = 'none';
      if (validateFields) {
        document.getElementById(dialogName).dispatchEvent(customEvent);
      } else {
        removeValidationErrors();
      }
      document.getElementById('name').value = '';
      document.getElementById('price').value = '';
      document.getElementById('addButton').focus();
      if (dialogName === 'dialog-submit') {
        onClose();
      }
    }
  }

  function openModal(dialogName, buttonName, trIndex) {
    const el = document.getElementById(dialogName);
    el.style.display = 'flex';
    if (trIndex) {
      setChosenElementByTrIndex(trIndex);
    }
    document.getElementById('name').focus();
    if (dialogName === 'dialog-edit') {
      editElement();
    }
    if (dialogName === 'dialog-remove') {
      document.getElementById('submit-remove').focus();
      document.getElementById('chosen_element_data').innerHTML = chosenElem.name + ': ' + chosenElem.price;
    }
  }

  function setChosenElementByTrIndex(trIndex) {
    chosenElem.price = document.getElementById(trIndex).childNodes[0].innerHTML;
    chosenElem.name = document.getElementById(trIndex).childNodes[1].innerHTML;
    chosenElem.id = trIndex.slice(3, 4);
  }

  function removeElement() {
    if (event && (event.keyCode === 13 || event.keyCode === 32)) {
      items = items.filter(el => el.id !== +chosenElem.id);
      saveItems();
      removeRows();
      createRows();
      document.getElementById('addButton').focus();
    }
  }

  function validateAddFields() {
    if (!document.getElementById('name').value) {
      document.querySelector('#dialog form .name-field').classList.add('invalid');
      document.getElementById('name').focus();
    } else {
      document.querySelector('#dialog form .name-field').classList.remove('invalid');
    }
    if (!document.getElementById('price').value) {
      document.querySelector('#dialog form .price-field').classList.add('invalid');
      document.getElementById('price').focus();
    } else {
      document.querySelector('#dialog form .price-field').classList.remove('invalid');
    }
  }

  function validateEditFields() {
    const val1 = document.getElementById('name-edit').value;
    const val2 = document.getElementById('price-edit').value;
    if (!val1) {
      document.querySelector('#dialog-edit form .name-edit-field').classList.add('invalid');
      document.getElementById('name-edit').focus();
    } else {
      document.querySelector('#dialog-edit form .name-edit-field').classList.remove('invalid');
    }
    if (!val2) {
      document.querySelector('#dialog-edit form .price-edit-field').classList.add('invalid');
      document.getElementById('price-edit').focus();
    } else {
      document.querySelector('#dialog-edit form .price-edit-field').classList.remove('invalid');
    }
    return +(!!val1 && !!val2)

  }

  function removeValidationErrors() {
    document.querySelector('#dialog-edit form .price-edit-field').classList.remove('invalid');
    document.querySelector('#dialog-edit form .name-edit-field').classList.remove('invalid');
    document.querySelector('#dialog form .price-field').classList.remove('invalid');
    document.querySelector('#dialog form .name-field').classList.remove('invalid');
  }

  function addElement() {
    let id = items.length;
    let name = document.getElementById('name').value;
    let price = document.getElementById('price').value;
    if (name && price) {
      items.push({id, name, price});
      saveItems();
      removeRows();
      createRows();
      closeOnEnter('dialog', null, false);
    } else {
      validateAddFields(true);
    }

  }

  function editElement() {
    document.getElementById('price-edit').value = chosenElem.price;
    document.getElementById('name-edit').value = chosenElem.name;
    document.getElementById('name-edit').focus();
    dialogEdit.addEventListener('close', (event) => {
      if (document.getElementById('name-edit').value && document.getElementById('price-edit').value) {
        let name = document.getElementById('name-edit').value;
        let price = document.getElementById('price-edit').value;
        items[items.findIndex(el => el.id === +chosenElem.id)] = {id: +chosenElem.id, name, price};
        saveItems();
        removeRows();
        createRows();
      }
    });
  }

  function onSubmit(e) {
    if (e && e.keyCode === 13) {
      dialogSubmit.style.display = "flex"
      dialogSubmit.addEventListener('close', onClose);
      resetForm();
    } else if (!e) {
      dialogSubmit.style.display = "flex"
      dialogSubmit.addEventListener('close', onClose);
      resetForm();
    }
  }

  function setFocusOnFirstElementOnStep() {
    document.getElementById('button3').focus();
  }


</script>
</body>
</html>


<!--todolist
role-alert dla walidacji niech przeczyta wszystkie bledy
step3:
focus trap na modalu ma dotyczyc tylko modalu bez pasków adresu przegladaraki etc
po usunieciu ustaw się na add button
po usunieciu jak zostanie ustaw na caption tabeli-->
